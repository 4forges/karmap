[Unit]
PartOf=<%= service.full_name %>.target

[Service]
WorkingDirectory=<%= work_directory %>
Environment=PORT=%i
Environment=KARMA_IDENTIFIER=%n
Environment=KARMA_ENV =<%= Karma.env %>
Environment=KARMA_PROJECT_ID =<%= Karma.karma_project_id %>
Environment=KARMA_USER_ID =<%= Karma.karma_user_id %>
Environment=KARMA_AWS_USER_ACCESS_KEY =<%= Karma.aws_access_key_id %>
Environment=KARMA_AWS_USER_SECRET_ACCESS_KEY =<%= Karma.aws_secret_access_key %>
ExecStart=/bin/bash -lc '<%= service.command %>'
Restart=always
StandardInput=null
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=%n
KillMode=mixed
TimeoutStopSec=<%= service.timeout_stop %>
<% if service.class.config_cpu_quota.present? %>CPUAccounting=true<% end %>
<% if service.class.config_cpu_quota.present? %>CPUQuota=<%= service.class.config_cpu_quota %>%<% end %>
<% if service.class.config_memory_max.present? %>MemoryAccounting=true<% end %>
<% if service.class.config_memory_max.present? %>MemoryLimit=<%= service.class.config_memory_max %><% end %>
